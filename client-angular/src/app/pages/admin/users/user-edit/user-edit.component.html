<div class="user-edit-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <span *ngIf="user"
          >Редактирование пользователя: {{ user.username }}</span
        >
        <span *ngIf="!user">Загрузка...</span>
      </mat-card-title>
      <mat-card-subtitle
        >Изменение данных и роли пользователя</mat-card-subtitle
      >
    </mat-card-header>

    <mat-card-content>
      <!-- Loading state -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Загрузка данных пользователя...</p>
      </div>

      <!-- Edit form -->
      <form
        *ngIf="!isLoading"
        [formGroup]="userForm"
        (ngSubmit)="onSubmit()"
        class="user-form"
      >
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Имя пользователя</mat-label>
            <input matInput formControlName="username" required />
            <mat-icon matSuffix>person</mat-icon>
            <mat-error *ngIf="userForm.get('username')?.hasError('required')">
              Имя пользователя обязательно
            </mat-error>
            <mat-error *ngIf="userForm.get('username')?.hasError('minlength')">
              Минимум 3 символа
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" required />
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="userForm.get('email')?.hasError('required')">
              Email обязателен
            </mat-error>
            <mat-error *ngIf="userForm.get('email')?.hasError('email')">
              Введите корректный email
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Роль пользователя</mat-label>
            <mat-select formControlName="role" required>
              <mat-option *ngFor="let role of roles" [value]="role.value">
                {{ role.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>security</mat-icon>
            <mat-error *ngIf="userForm.get('role')?.hasError('required')">
              Выберите роль пользователя
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button
            mat-button
            type="button"
            (click)="onCancel()"
            class="cancel-button"
          >
            Отмена
          </button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="!userForm.valid || isSubmitting"
            class="submit-button"
          >
            <mat-spinner
              diameter="20"
              *ngIf="isSubmitting"
              class="button-spinner"
            ></mat-spinner>
            <span *ngIf="!isSubmitting">Сохранить изменения</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
